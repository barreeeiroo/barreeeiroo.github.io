---
import ProjectLayout from '../../layouts/ProjectLayout.astro';
import { Icon } from 'astro-icon/components';
import { Image } from 'astro:assets';
import { FULL_NAME } from '../../config';
import creatorLight from '../../assets/kodular/creator_light.png';
import creatorBlocks from '../../assets/kodular/creator_blocks_light.png';
import creatorProjectSettings from '../../assets/kodular/creator_project_settings_light.png';
import creatorProjects from '../../assets/kodular/creator_projects_light.png';
import creatorApkBuild from '../../assets/kodular/creator_apk_build_light.png';

const title = "Kodular";
const description = "A drag-and-drop platform that democratizes mobile app development, enabling anyone to build Android apps without writing a single line of code.";

const timelineEvents = [
  {
    year: '2017',
    events: [
      { date: 'JULY 6, 2017', text: 'Kodular founded by 7 co-founders as a fork from MIT App Inventor 2' },
      { date: 'JULY 23, 2017', text: 'First public beta version released as "Makeroid"' }
    ]
  },
  {
    year: '2018',
    events: [
      { date: 'JUNE 22, 2018', text: 'First production version: Kodular Andromeda' },
      { date: 'OCTOBER 26, 2018', text: 'Rebranded from "Makeroid" to "Kodular"' }
    ]
  },
  {
    year: '2019',
    events: [
      { date: 'AUGUST 31, 2019', text: 'Merged with AppyBuilder, another fork from MIT App Inventor 2' }
    ]
  },
  {
    year: '2021',
    events: [
      { date: 'JULY 15, 2021', text: 'Google partnership launched with Google Ad Manager integration' }
    ]
  },
  {
    year: '2022',
    events: [
      { date: 'JULY 11, 2022', text: 'Introduced Kodular Premium' }
    ]
  },
  {
    year: '2023',
    events: [
      { date: 'FEBRUARY 2023', text: 'Announced planned collaboration with MIT App Inventor 2' }
    ]
  },
  {
    year: '2025',
    events: [
      { date: 'JULY 29, 2025', text: 'Launched Kodular Monetize as a new usage-based pricing system' }
    ]
  }
];
---

<ProjectLayout title={title} description={description}>
  <!-- Project Info Section -->
  <section class="section-animate px-6 md:px-12 pb-16 md:pb-24">
    <div class="max-w-6xl mx-auto">
      <!-- Role & Links -->
      <div class="section-content mb-12">
        <div class="inline-block border-2 border-primary px-4 py-2 mb-6">
          <p class="text-primary font-bold uppercase tracking-wider text-sm">
            Co-founder & CEO
          </p>
        </div>

        <div class="flex gap-6 flex-wrap">
          <a
            href="https://www.kodular.io/"
            class="inline-flex items-center gap-2 text-gray-light hover:text-primary transition-colors text-sm uppercase tracking-wider"
            target="_blank"
            rel="noopener noreferrer"
          >
            <Icon name="carbon:launch" class="w-5 h-5" />
            Visit Site
          </a>
            <a
                    href="https://github.com/Kodular"
                    class="inline-flex items-center gap-2 text-gray-light hover:text-primary transition-colors text-sm uppercase tracking-wider"
                    target="_blank"
                    rel="noopener noreferrer"
            >
                <Icon name="carbon:logo-github" class="w-5 h-5" />
                GitHub
            </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Stats Section -->
  <section class="section-animate py-16 md:py-24 px-6 md:px-12 bg-navy/50">
    <div class="max-w-6xl mx-auto">
      <h2 class="section-heading text-xs md:text-sm font-bold tracking-widest text-primary uppercase mb-12">
        Impact & Reach
      </h2>

      <div class="section-content grid grid-cols-1 lg:grid-cols-[1fr_2fr] gap-12 items-start">
        <!-- Stats - Left Side -->
        <div class="space-y-8">
          <!-- Stat 1 -->
          <div class="stat-item border-l-4 border-primary pl-6 transition-all duration-300 hover:pl-8 hover:border-l-8">
            <div class="stat-number text-5xl md:text-6xl font-bold text-white mb-2 transition-transform duration-300">2.0M+</div>
            <div class="text-gray-light uppercase tracking-wider text-sm">Active Developers</div>
            <div class="text-gray-light/60 text-xs mt-1">From 200+ Countries</div>
          </div>

          <!-- Stat 2 -->
          <div class="stat-item border-l-4 border-primary pl-6 transition-all duration-300 hover:pl-8 hover:border-l-8">
            <div class="stat-number text-5xl md:text-6xl font-bold text-white mb-2 transition-transform duration-300">4.7M+</div>
            <div class="text-gray-light uppercase tracking-wider text-sm">Apps Created</div>
            <div class="text-gray-light/60 text-xs mt-1">On The Platform</div>
          </div>

          <!-- Stat 3 -->
          <div class="stat-item border-l-4 border-primary pl-6 transition-all duration-300 hover:pl-8 hover:border-l-8">
            <div class="stat-number text-5xl md:text-6xl font-bold text-white mb-2 transition-transform duration-300">1.4M+</div>
            <div class="text-gray-light uppercase tracking-wider text-sm">Daily Active Users</div>
            <div class="text-gray-light/60 text-xs mt-1">Using Kodular Apps</div>
          </div>
        </div>

        <!-- Kodular Creator Screenshot - Right Side (Larger) -->
        <div class="relative group">
          <div class="border-2 border-primary absolute inset-0 translate-x-3 translate-y-3 transition-transform group-hover:translate-x-1 group-hover:translate-y-1"></div>
          <div class="relative overflow-hidden border-2 border-primary bg-black">
            <Image
              src={creatorLight}
              alt="Kodular Creator Interface - Block-based visual programming editor"
              class="w-full h-auto grayscale group-hover:grayscale-0 transition-all duration-300"
              quality={90}
              loading="eager"
              fetchpriority="high"
            />
            <div class="absolute inset-0 bg-primary/20 group-hover:bg-transparent transition-all"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Timeline Section -->
  <section class="timeline-section section-animate py-16 md:py-24 px-6 md:px-12">
    <div class="max-w-6xl mx-auto">
      <h2 class="section-heading text-xs md:text-sm font-bold tracking-widest text-primary uppercase mb-12">
        Timeline & Milestones
      </h2>

      <!-- Year buttons -->
      <div class="section-content flex flex-wrap gap-3 mb-8">
        {timelineEvents.map((yearData, index) => (
          <button
            class={`year-btn border-2 border-primary px-6 py-3 text-xl font-bold uppercase tracking-wider transition-all hover:bg-primary hover:text-black ${index === 0 ? 'bg-primary text-black' : 'text-primary'}`}
            data-year={yearData.year}
          >
            {yearData.year}
          </button>
        ))}
      </div>

      <!-- Events display area -->
      <div class="year-content-container relative" style="min-height: 300px;">
        {timelineEvents.map((yearData, index) => (
          <div
            class={`year-content absolute top-0 left-0 right-0 transition-opacity duration-300 ${index === 0 ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}
            data-year-content={yearData.year}
          >
            <div class="border-4 border-primary p-6 md:p-8 bg-navy/20">
              <h3 class="text-4xl md:text-5xl font-bold text-white mb-6 md:mb-8">{yearData.year}</h3>
              <div class="space-y-4 md:space-y-6">
                {yearData.events.map((event) => (
                  <div class="border-l-4 border-primary pl-4 md:pl-6 py-3">
                    <div class="text-primary text-xs md:text-sm font-bold uppercase tracking-wider mb-2">{event.date}</div>
                    <p class="text-gray-light text-base md:text-lg">{event.text}</p>
                  </div>
                ))}
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Role & Contributions Section -->
  <section class="section-animate py-16 md:py-24 px-6 md:px-12 bg-navy/50">
    <div class="max-w-6xl mx-auto">
      <h2 class="section-heading text-xs md:text-sm font-bold tracking-widest text-primary uppercase mb-12">
        My Role & Contributions
      </h2>

      <div class="section-content grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Company Leadership -->
        <div>
          <h3 class="text-xl font-bold text-white mb-6 uppercase tracking-wider border-b-2 border-primary pb-3">
            Company Leadership
          </h3>
          <ul class="space-y-3 text-gray-light">
            <li class="flex items-start gap-3">
              <span class="text-primary text-lg">→</span>
              <span>Led company communications and updates through The Kodular Korner blog</span>
            </li>
            <li class="flex items-start gap-3">
              <span class="text-primary text-lg">→</span>
              <span>Oversaw AppyBuilder merge and integration</span>
            </li>
            <li class="flex items-start gap-3">
              <span class="text-primary text-lg">→</span>
              <span>Guided platform growth from beta to production, serving millions of users</span>
            </li>
            <li class="flex items-start gap-3">
              <span class="text-primary text-lg">→</span>
              <span>Contribute features back to MIT App Inventor 2</span>
            </li>
          </ul>
        </div>

        <!-- Technical Contributions -->
        <div>
          <h3 class="text-xl font-bold text-white mb-6 uppercase tracking-wider border-b-2 border-primary pb-3">
            Technical Contributions
          </h3>
          <ul class="space-y-3 text-gray-light">
            <li class="flex items-start gap-3">
              <span class="text-primary text-lg">→</span>
              <span>Developed <strong class="text-white">My Kodular</strong> - User dashboard and account management system</span>
            </li>
            <li class="flex items-start gap-3">
              <span class="text-primary text-lg">→</span>
              <span>Developed <strong class="text-white">Kodular Auth</strong> - Centralized authentication service with 2FA support</span>
            </li>
            <li class="flex items-start gap-3">
              <span class="text-primary text-lg">→</span>
              <span>Developed <strong class="text-white">Kodular Monetize</strong> - Usage-based ad monetization system</span>
            </li>
            <li class="flex items-start gap-3">
              <span class="text-primary text-lg">→</span>
              <span>Manage all infrastructure across Google Cloud Platform, AWS, and Hetzner</span>
            </li>
          </ul>
        </div>
      </div>

      <!-- Partnerships Section -->
      <div class="partnerships-section mt-12 pt-12 border-t-2 border-primary/20">
        <h3 class="text-xl font-bold text-white mb-6 uppercase tracking-wider">
          Key Partnerships & Integrations
        </h3>
        <div class="partnerships-grid grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="partnership-item border-l-4 border-primary pl-4 transition-all duration-300 hover:pl-6 hover:border-l-8">
            <div class="partnership-title text-white font-bold mb-1 text-lg transition-transform duration-300">AppyBuilder</div>
            <div class="text-gray-light">Merged (2019)</div>
          </div>
          <div class="partnership-item border-l-4 border-primary pl-4 transition-all duration-300 hover:pl-6 hover:border-l-8">
            <div class="partnership-title text-white font-bold mb-1 text-lg transition-transform duration-300">Google</div>
            <div class="text-gray-light">Ad Manager integration (2021)</div>
          </div>
          <div class="partnership-item border-l-4 border-primary pl-4 transition-all duration-300 hover:pl-6 hover:border-l-8">
            <div class="partnership-title text-white font-bold mb-1 text-lg transition-transform duration-300">MIT App Inventor</div>
            <div class="text-gray-light">Planned collaboration (2023)</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Tech Stack Section -->
  <section class="section-animate py-16 md:py-24 px-6 md:px-12">
    <div class="max-w-6xl mx-auto">
      <h2 class="section-heading text-xs md:text-sm font-bold tracking-widest text-primary uppercase mb-12">
        Technology & Infrastructure
      </h2>

      <div class="section-content grid grid-cols-1 md:grid-cols-2 gap-12 mb-12">
        <!-- Tech Stack -->
        <div>
          <h3 class="text-xl font-bold text-white mb-6 uppercase tracking-wider border-b-2 border-primary pb-3">
            Tech Stack
          </h3>
          <ul class="space-y-3 text-gray-light">
            <li class="flex items-start gap-3">
              <span class="text-primary">•</span>
              <span><strong class="text-white">Kodular Creator:</strong> Java, GWT (Google Web Toolkit), GCP, Hetzner</span>
            </li>
            <li class="flex items-start gap-3">
              <span class="text-primary">•</span>
              <span><strong class="text-white">Kodular Auth:</strong> Django, Python, AWS</span>
            </li>
            <li class="flex items-start gap-3">
              <span class="text-primary">•</span>
              <span><strong class="text-white">My Kodular:</strong> Django, Python, AWS</span>
            </li>
            <li class="flex items-start gap-3">
              <span class="text-primary">•</span>
              <span><strong class="text-white">Kodular Monetize:</strong> Serverless Microservices, Python, AWS</span>
            </li>
          </ul>
        </div>

        <!-- Infrastructure -->
        <div>
          <h3 class="text-xl font-bold text-white mb-6 uppercase tracking-wider border-b-2 border-primary pb-3">
            Infrastructure
          </h3>
          <div class="flex flex-wrap gap-3">
            <span class="border-2 border-primary px-4 py-2 text-primary font-bold text-sm uppercase tracking-wider">Google Cloud Platform</span>
            <span class="border-2 border-primary px-4 py-2 text-primary font-bold text-sm uppercase tracking-wider">Amazon Web Services</span>
            <span class="border-2 border-primary px-4 py-2 text-primary font-bold text-sm uppercase tracking-wider">Hetzner</span>
          </div>
        </div>
      </div>

      <!-- Platform Screenshots -->
      <div class="screenshots-section mt-12">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Screenshot 1: Blocks Editor -->
          <div class="screenshot-item relative group">
            <div class="border-2 border-primary absolute inset-0 translate-x-2 translate-y-2 transition-transform group-hover:translate-x-1 group-hover:translate-y-1"></div>
            <div class="relative overflow-hidden border-2 border-primary bg-black">
              <Image
                src={creatorBlocks}
                alt="Kodular Creator - Block-based programming interface"
                class="w-full h-auto grayscale group-hover:grayscale-0 transition-all duration-300"
                quality={90}
                loading="eager"
              />
              <div class="absolute inset-0 bg-primary/20 group-hover:bg-transparent transition-all"></div>
            </div>
          </div>

          <!-- Screenshot 2: Project Settings -->
          <div class="screenshot-item relative group">
            <div class="border-2 border-primary absolute inset-0 translate-x-2 translate-y-2 transition-transform group-hover:translate-x-1 group-hover:translate-y-1"></div>
            <div class="relative overflow-hidden border-2 border-primary bg-black">
              <Image
                src={creatorProjectSettings}
                alt="Kodular Creator - Project settings configuration"
                class="w-full h-auto grayscale group-hover:grayscale-0 transition-all duration-300"
                quality={90}
                loading="eager"
              />
              <div class="absolute inset-0 bg-primary/20 group-hover:bg-transparent transition-all"></div>
            </div>
          </div>

          <!-- Screenshot 3: Projects Dashboard -->
          <div class="screenshot-item relative group">
            <div class="border-2 border-primary absolute inset-0 translate-x-2 translate-y-2 transition-transform group-hover:translate-x-1 group-hover:translate-y-1"></div>
            <div class="relative overflow-hidden border-2 border-primary bg-black">
              <Image
                src={creatorProjects}
                alt="Kodular Creator - Projects management dashboard"
                class="w-full h-auto grayscale group-hover:grayscale-0 transition-all duration-300"
                quality={90}
                loading="eager"
              />
              <div class="absolute inset-0 bg-primary/20 group-hover:bg-transparent transition-all"></div>
            </div>
          </div>

          <!-- Screenshot 4: APK Build -->
          <div class="screenshot-item relative group">
            <div class="border-2 border-primary absolute inset-0 translate-x-2 translate-y-2 transition-transform group-hover:translate-x-1 group-hover:translate-y-1"></div>
            <div class="relative overflow-hidden border-2 border-primary bg-black">
              <Image
                src={creatorApkBuild}
                alt="Kodular Creator - APK build and export interface"
                class="w-full h-auto grayscale group-hover:grayscale-0 transition-all duration-300"
                quality={90}
                loading="eager"
              />
              <div class="absolute inset-0 bg-primary/20 group-hover:bg-transparent transition-all"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</ProjectLayout>

<script>
  import { accessibleAnimate, getAnimationDelay } from '../../utils/motion';
  import { animate } from 'motion';

  document.addEventListener('DOMContentLoaded', () => {
    const observerOptions = {
      root: null,
      threshold: 0.1,
      rootMargin: '0px 0px 100px 0px'
    };

    const animatedSections = new Set<Element>();

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting && !animatedSections.has(entry.target)) {
          animatedSections.add(entry.target);
          animateSection(entry.target as HTMLElement);
        }
      });
    }, observerOptions);

    // Observe all sections
    const sections = document.querySelectorAll('.section-animate');
    sections.forEach((section) => {
      observer.observe(section);
    });

    function animateSection(section: HTMLElement) {
      // Animate section heading
      const heading = section.querySelector('.section-heading');
      if (heading) {
        accessibleAnimate(
          heading,
          { opacity: [0, 1], y: [-20, 0] },
          { duration: 0.6, easing: 'ease-out' }
        );
      }

      // Animate section content
      const content = section.querySelector('.section-content');
      if (content) {
        accessibleAnimate(
          content,
          { opacity: [0, 1], y: [20, 0] },
          { duration: 0.5, delay: getAnimationDelay(0.05), easing: 'ease-out' }
        );
      }

      // Animate partnerships
      const partnershipsSection = section.querySelector('.partnerships-section');
      if (partnershipsSection) {
        const title = partnershipsSection.querySelector('h3');
        if (title) {
          accessibleAnimate(
            title,
            { opacity: [0, 1], y: [-15, 0] },
            { duration: 0.5, delay: getAnimationDelay(0.4), easing: 'ease-out' }
          );
        }

        const partnershipsGrid = partnershipsSection.querySelectorAll('.partnerships-grid > div');
        partnershipsGrid.forEach((partnership, index) => {
          accessibleAnimate(
            partnership,
            { opacity: [0, 1], x: [-20, 0] },
            { duration: 0.5, delay: getAnimationDelay(0.6 + index * 0.1), easing: 'ease-out' }
          );
        });
      }

      // Animate screenshots
      const screenshotsSection = section.querySelector('.screenshots-section');
      if (screenshotsSection) {
        const screenshots = screenshotsSection.querySelectorAll('.screenshot-item');
        screenshots.forEach((screenshot, index) => {
          accessibleAnimate(
            screenshot,
            { opacity: [0, 1], y: [30, 0] },
            { duration: 0.6, delay: getAnimationDelay(0.3 + index * 0.15), easing: 'ease-out' }
          );
        });
      }

    }
  });
</script>

<script>
  // Year selector functionality
  document.addEventListener('DOMContentLoaded', () => {
    const yearButtons = document.querySelectorAll('.year-btn');
    const yearContents = document.querySelectorAll('.year-content');
    const container = document.querySelector('.year-content-container');

    // Function to update container height
    const updateContainerHeight = (activeContent) => {
      if (container && activeContent) {
        const height = activeContent.offsetHeight;
        container.style.minHeight = height + 'px';
      }
    };

    // Set initial height
    const initialContent = document.querySelector('.year-content.opacity-100');
    if (initialContent) {
      updateContainerHeight(initialContent);
    }

    yearButtons.forEach(button => {
      button.addEventListener('click', () => {
        const selectedYear = button.getAttribute('data-year');

        // Update button states
        yearButtons.forEach(btn => {
          if (btn.getAttribute('data-year') === selectedYear) {
            btn.classList.add('bg-primary', 'text-black');
            btn.classList.remove('text-primary');
          } else {
            btn.classList.remove('bg-primary', 'text-black');
            btn.classList.add('text-primary');
          }
        });

        // Show selected year content with fade
        yearContents.forEach(content => {
          if (content.getAttribute('data-year-content') === selectedYear) {
            content.classList.remove('opacity-0', 'pointer-events-none');
            content.classList.add('opacity-100');

            // Update container height
            setTimeout(() => {
              updateContainerHeight(content);
            }, 50);
          } else {
            content.classList.add('opacity-0', 'pointer-events-none');
            content.classList.remove('opacity-100');
          }
        });
      });
    });
  });
</script>

<style>
  /* Partnerships section */
  .partnerships-section h3,
  .partnerships-grid > div {
    opacity: 0;
  }

  /* Screenshots */
  .screenshot-item {
    opacity: 0;
  }

  /* Timeline year selector */
  .year-content-container {
    position: relative;
    transition: min-height 0.3s ease;
  }

  .year-content {
    transition: opacity 0.3s ease;
  }

  /* Stat hover effects */
  .stat-item:hover .stat-number {
    transform: scale(1.05);
  }

  /* Partnership hover effects */
  .partnership-item:hover .partnership-title {
    transform: translateX(5px);
  }
</style>
