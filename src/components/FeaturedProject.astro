---
import type { CollectionEntry } from 'astro:content';
import { Image } from 'astro:assets';
import { Icon } from 'astro-icon/components';

interface Props {
  project: CollectionEntry<'featured-projects'>;
  imageAlign: 'left' | 'right';
  featuredImages: Record<string, () => Promise<{ default: ImageMetadata }>>;
}

const { project, imageAlign, featuredImages } = Astro.props;
const { Content } = await project.render();
---

<div class="project-card featured-project relative">
  <!-- Mobile: Background Image Layout -->
  <div class="min-[960px]:hidden relative group">
    <div class="border-2 border-primary absolute inset-0 translate-x-2 translate-y-2 transition-transform group-hover:translate-x-1 group-hover:translate-y-1"></div>
    <div class="relative overflow-hidden border-2 border-primary bg-black">
      <!-- Background Image -->
      <div class="absolute inset-0">
        <Image
          src={featuredImages[project.data.image]()}
          alt={project.data.title}
          class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-300"
          quality={90}
        />
        <!-- Dark overlay -->
        <div class="absolute inset-0 bg-gradient-to-b from-black/70 via-black/80 to-black/90"></div>
      </div>

      <!-- Content Overlay -->
      <div class="relative p-6 min-h-[400px] flex flex-col justify-end">
      <p class="text-xs text-primary uppercase tracking-widest mb-2">Featured Project</p>
      <h3 class="text-2xl font-bold text-white mb-4">{project.data.title}</h3>

      <div class="mb-4">
        <div class="prose prose-invert prose-sm max-w-none text-gray-light [&>p]:mb-3 [&>ul]:list-disc [&>ul]:ml-5 [&>ul]:mb-3 [&>li]:mb-1">
          <Content />
        </div>
      </div>

      <div class="flex flex-wrap gap-2 mb-4 text-xs text-gray-light">
        {project.data.technologies.map((tech) => (
          <span class="uppercase tracking-wider border border-primary/30 px-2 py-1">{tech}</span>
        ))}
      </div>

      <div class="flex gap-4">
        {project.data.githubUrl && (
          <a
            href={project.data.githubUrl}
            class="text-gray-light hover:text-primary transition-colors"
            aria-label="GitHub"
          >
            <Icon name="carbon:logo-github" class="w-5 h-5" />
          </a>
        )}
        {project.data.externalUrl && (
          <a
            href={project.data.externalUrl}
            class="text-gray-light hover:text-primary transition-colors"
            aria-label="External Link"
          >
            <Icon name="carbon:launch" class="w-5 h-5" />
          </a>
        )}
      </div>
      </div>
    </div>
  </div>

  <!-- Desktop: Overlapping Layout -->
  <div class="hidden min-[960px]:flex min-[960px]:items-center">
    <!-- Project Image - 60% width -->
    <div class={`relative group w-[60%] ${imageAlign === 'left' ? '' : 'ml-auto'}`}>
      <div class="border-2 border-primary absolute inset-0 translate-x-3 translate-y-3 transition-transform group-hover:translate-x-1 group-hover:translate-y-1"></div>
      <div class="relative overflow-hidden border-2 border-primary bg-black">
        <Image
          src={featuredImages[project.data.image]()}
          alt={project.data.title}
          class="w-full aspect-video object-cover grayscale group-hover:grayscale-0 transition-all duration-300"
          quality={90}
        />
        <div class="absolute inset-0 bg-primary/20 group-hover:bg-transparent transition-all"></div>
      </div>
    </div>

    <!-- Project Info - Overlapping - 50% width -->
    <div class={`absolute top-1/2 -translate-y-1/2 w-[50%] ${imageAlign === 'left' ? 'right-0' : 'left-0'}`}>
      <div class={`${imageAlign === 'left' ? 'text-right' : 'text-left'}`}>
        <p class="text-xs text-primary uppercase tracking-widest mb-2">Featured Project</p>
        <h3 class="text-2xl font-bold text-white mb-4">{project.data.title}</h3>
      </div>
      <div class="bg-navy border-2 border-primary/50 p-6 mb-4 backdrop-blur-sm">
        <div class="prose prose-invert prose-sm max-w-none text-gray-light [&>p]:mb-4 [&>ul]:list-disc [&>ul]:ml-5 [&>ul]:mb-4 [&>li]:mb-1">
          <Content />
        </div>
      </div>
      <div class={`flex flex-wrap gap-3 mb-4 text-xs text-gray-light ${imageAlign === 'left' ? 'justify-end' : 'justify-start'}`}>
        {project.data.technologies.map((tech) => (
          <span class="uppercase tracking-wider">{tech}</span>
        ))}
      </div>
      <div class={`flex gap-4 ${imageAlign === 'left' ? 'justify-end' : 'justify-start'}`}>
        {project.data.githubUrl && (
          <a
            href={project.data.githubUrl}
            class="text-gray-light hover:text-primary transition-colors"
            aria-label="GitHub"
          >
            <Icon name="carbon:logo-github" class="w-5 h-5" />
          </a>
        )}
        {project.data.externalUrl && (
          <a
            href={project.data.externalUrl}
            class="text-gray-light hover:text-primary transition-colors"
            aria-label="External Link"
          >
            <Icon name="carbon:launch" class="w-5 h-5" />
          </a>
        )}
      </div>
    </div>
  </div>
</div>
